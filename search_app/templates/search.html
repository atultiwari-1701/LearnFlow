<!DOCTYPE html>
<html>
<head>
    <title>Gemini Search</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        .loading {
            text-align: center;
            font-style: italic;
            color: gray;
        }
    </style>
</head>
<body>
    <h1>Gemini Search</h1>
    <input type="text" id="search_input">
    <button id="search_button">Search</button>
    <div id="result_container"></div>
    <div id="loading_indicator" class="loading" style="display: none;">Loading...</div>

    <script>
        $(document).ready(function() {
    $('#search_button').click(function() {
        var searchQuery = $('#search_input').val();
        $.ajax({
            url: '/gemini-search/search/',
            type: 'POST',
            data: { 'search_query': searchQuery, 'csrfmiddlewaretoken': '{{ csrf_token }}' },
            dataType: 'json',
            headers: { 'X-Requested-With': 'XMLHttpRequest' },
            beforeSend: function() {
                $('#result_container').html('');
                $('#loading_indicator').show();
            },
            success: function(response) {
                $('#loading_indicator').hide();
                console.log("Full response:", response);
                if (response && response.result) {
                    try {
                        console.log("Response Result String:", response.result); // Log the raw JSON string
                        const parsedResponse = JSON.parse(response.result); // Parse JSON
                        console.log("Parsed Response:", parsedResponse); // Log the parsed object
                        const data = parsedResponse; // Extract the object

                        console.log("Short Description:", data["Short Description"]);
                        console.log("Need to Learn:", data["Need to Learn " + searchQuery]);
                        console.log("Subtopics:", data["SubTopics of " + searchQuery]);
                        console.log("Roadmap:", data["Road Map to Learn " + searchQuery]);
                        console.log("Resource Tabs:", data["Resource Tab Suggestions for " + searchQuery]);
                        console.log("Key Takeaways:", data["Key Takeaways"]);
                        console.log("FAQ:", data["Frequently Asked Questions"]);
                        console.log("Related Topics:", data["Related Topics"]);

                        // Display the parsed JSON object
                        $('#result_container').html('<pre>' + JSON.stringify(data, null, 2) + '</pre>');

                    } catch (e) {
                        console.error("Error parsing JSON:", e);
                        $('#result_container').html('<p style="color:red;">Error parsing JSON: ' + e + '</p>');
                    }
                } else if (response && response.error) {
                    $('#result_container').html('<p style="color:red;">' + response.error + '</p>');
                }
            },
            error: function(xhr, status, error) {
                console.log("AJAX Error:", xhr, status, error);
                $('#loading_indicator').hide();
                $('#result_container').html('<p style="color:red;">An error occurred: ' + error + '</p>');
            }
        });
    });
});
    </script>
    {% csrf_token %}
</body>
</html>